<!-- Modal de detalles de organización -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- Header del modal -->
    <div class="modal-header">
      <h2>Organización datos</h2>
      <div class="header-actions">
        <button type="button" class="btn btn-primary" *ngIf="canEdit && !isEditing" (click)="toggleEdit()">
          Editar
        </button>
        <button type="button" class="btn btn-danger" *ngIf="canDelete" (click)="deleteOrganization()">
          Eliminar
        </button>
        <button type="button" class="close-btn" (click)="closeModal()" aria-label="Cerrar">
          <img src="assets/images/close.png" alt="Cerrar">
        </button>
      </div>
    </div>

    <!-- Contenido del modal -->
    <div class="modal-body">
      <form [formGroup]="organizationForm" *ngIf="organization">
        <div class="form-group">
          <label for="nombre">Nombre:</label>
          <input 
            type="text" 
            id="nombre" 
            formControlName="nombre" 
            [readonly]="!isEditing"
            [ngClass]="{'readonly': !isEditing, 'is-invalid': organizationForm.get('nombre')?.invalid && organizationForm.get('nombre')?.touched}"
          >
          <div *ngIf="organizationForm.get('nombre')?.hasError('required') && organizationForm.get('nombre')?.touched && isEditing"
               class="invalid-feedback">
            El nombre es obligatorio.
          </div>
          <div *ngIf="organizationForm.get('nombre')?.hasError('dangerousContent') && organizationForm.get('nombre')?.touched && isEditing"
               class="invalid-feedback">
            {{ organizationForm.get('nombre')?.errors?.['dangerousContent']?.message || 'El nombre contiene caracteres no permitidos.' }}
          </div>
        </div>

        <div class="form-group">
          <label for="nit">Nit:</label>
          <input 
            type="text" 
            id="nit" 
            formControlName="nit" 
            [readonly]="!isEditing"
            [ngClass]="{'readonly': !isEditing, 'is-invalid': organizationForm.get('nit')?.invalid && organizationForm.get('nit')?.touched}"
          >
          <div *ngIf="organizationForm.get('nit')?.hasError('required') && organizationForm.get('nit')?.touched && isEditing"
               class="invalid-feedback">
            El NIT es obligatorio.
          </div>
          <div *ngIf="organizationForm.get('nit')?.hasError('dangerousContent') && organizationForm.get('nit')?.touched && isEditing"
               class="invalid-feedback">
            {{ organizationForm.get('nit')?.errors?.['dangerousContent']?.message || 'El NIT contiene caracteres no permitidos.' }}
          </div>
        </div>

        <div class="form-group">
          <label for="ubicacion">Ubicación:</label>
          <input 
            type="text" 
            id="ubicacion" 
            formControlName="ubicacion" 
            [readonly]="!isEditing"
            [ngClass]="{'readonly': !isEditing, 'is-invalid': organizationForm.get('ubicacion')?.invalid && organizationForm.get('ubicacion')?.touched}"
          >
          <div *ngIf="organizationForm.get('ubicacion')?.hasError('required') && organizationForm.get('ubicacion')?.touched && isEditing"
               class="invalid-feedback">
            La ubicación es obligatoria.
          </div>
          <div *ngIf="organizationForm.get('ubicacion')?.hasError('dangerousContent') && organizationForm.get('ubicacion')?.touched && isEditing"
               class="invalid-feedback">
            {{ organizationForm.get('ubicacion')?.errors?.['dangerousContent']?.message || 'La ubicación contiene caracteres no permitidos.' }}
          </div>
        </div>

        <div class="form-group">
          <label for="representanteLegal">Representante Legal:</label>
          <input 
            type="text" 
            id="representanteLegal" 
            formControlName="representanteLegal" 
            [readonly]="!isEditing"
            [ngClass]="{'readonly': !isEditing, 'is-invalid': organizationForm.get('representanteLegal')?.invalid && organizationForm.get('representanteLegal')?.touched}"
          >
          <div *ngIf="organizationForm.get('representanteLegal')?.hasError('required') && organizationForm.get('representanteLegal')?.touched && isEditing"
               class="invalid-feedback">
            El representante legal es obligatorio.
          </div>
          <div *ngIf="organizationForm.get('representanteLegal')?.hasError('dangerousContent') && organizationForm.get('representanteLegal')?.touched && isEditing"
               class="invalid-feedback">
            {{ organizationForm.get('representanteLegal')?.errors?.['dangerousContent']?.message || 'El representante legal contiene caracteres no permitidos.' }}
          </div>
        </div>

        <div class="form-group">
          <label for="telefono">Teléfono:</label>
          <input 
            type="tel" 
            id="telefono" 
            formControlName="telefono" 
            [readonly]="!isEditing"
            [ngClass]="{'readonly': !isEditing, 'is-invalid': organizationForm.get('telefono')?.invalid && organizationForm.get('telefono')?.touched}"
          >
          <div *ngIf="organizationForm.get('telefono')?.hasError('required') && organizationForm.get('telefono')?.touched && isEditing"
               class="invalid-feedback">
            El teléfono es obligatorio.
          </div>
          <div *ngIf="organizationForm.get('telefono')?.hasError('dangerousContent') && organizationForm.get('telefono')?.touched && isEditing"
               class="invalid-feedback">
            {{ organizationForm.get('telefono')?.errors?.['dangerousContent']?.message || 'El teléfono contiene caracteres no permitidos.' }}
          </div>
        </div>

        <div class="form-group">
          <label for="sectorEconomico">Sector económico:</label>
          <select 
            id="sectorEconomico" 
            formControlName="sectorEconomico" 
            [disabled]="!isEditing"
            [ngClass]="{'readonly': !isEditing, 'is-invalid': organizationForm.get('sectorEconomico')?.invalid && organizationForm.get('sectorEconomico')?.touched}"
          >
            <option value="" disabled>Seleccione un sector económico</option>
            <option value="Primario">Primario</option>
            <option value="Secundario">Secundario</option>
            <option value="Terciario">Terciario</option>
            <option value="Cuaternario">Cuaternario</option>
            <option value="Quinario">Quinario</option>
          </select>
          <div *ngIf="organizationForm.get('sectorEconomico')?.hasError('required') && organizationForm.get('sectorEconomico')?.touched && isEditing"
               class="invalid-feedback">
            El sector económico es obligatorio.
          </div>
          <div *ngIf="organizationForm.get('sectorEconomico')?.hasError('dangerousContent') && organizationForm.get('sectorEconomico')?.touched && isEditing"
               class="invalid-feedback">
            {{ organizationForm.get('sectorEconomico')?.errors?.['dangerousContent']?.message || 'El sector económico contiene caracteres no permitidos.' }}
          </div>
        </div>

        <div class="form-group">
          <label for="actividadPrincipal">Actividad principal:</label>
          <input 
            type="text" 
            id="actividadPrincipal" 
            formControlName="actividadPrincipal" 
            [readonly]="!isEditing"
            [ngClass]="{'readonly': !isEditing, 'is-invalid': organizationForm.get('actividadPrincipal')?.invalid && organizationForm.get('actividadPrincipal')?.touched}"
          >
          <div *ngIf="organizationForm.get('actividadPrincipal')?.hasError('required') && organizationForm.get('actividadPrincipal')?.touched && isEditing"
               class="invalid-feedback">
            La actividad principal es obligatoria.
          </div>
          <div *ngIf="organizationForm.get('actividadPrincipal')?.hasError('dangerousContent') && organizationForm.get('actividadPrincipal')?.touched && isEditing"
               class="invalid-feedback">
            {{ organizationForm.get('actividadPrincipal')?.errors?.['dangerousContent']?.message || 'La actividad principal contiene caracteres no permitidos.' }}
          </div>
        </div>

        <!-- Botones de acción cuando está editando -->
        <div class="form-actions" *ngIf="isEditing">
          <button type="button" class="btn btn-primary" (click)="saveChanges()">
            Guardar
          </button>
          <button type="button" class="btn btn-secondary" (click)="toggleEdit()">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
