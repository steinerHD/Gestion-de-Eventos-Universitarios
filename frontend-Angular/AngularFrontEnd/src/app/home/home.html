<div class="main-navbar">
  <nav class="navbar-custom">
    <div class="navbar-logo">
      <img src="assets/images/U_events.png" alt="Logo" class="logo-img"/>
    </div>

    <div class="navbar-search">
      <i class="fas fa-search"></i>
      <input type="text" class="search-input" placeholder="Buscar evento..." (input)="searchEvents($event.target.value)" />
    </div>

    <div class="navbar-icons">
      <button class="btn btn-light btn-create" *ngIf="isSecretaria" routerLink="/aprobar-eventos"><i class="ri-todo-line"></i> Califica los eventos</button>
      <button class="btn btn-light btn-create" *ngIf="!isSecretaria" routerLink="/add-event">+ Crear evento</button>
      
      <!-- Campana de notificaciones -->
      <div class="notification-bell" (click)="toggleNotificaciones($event)">
        <i class="ri-notification-3-line"></i>
        <span class="notification-badge" *ngIf="notificacionesNoLeidas > 0">{{ notificacionesNoLeidas }}</span>
      </div>
      
      <i class="ri-account-circle-fill" id="perfilBtn" routerLink="/profile-menu"></i>
    </div>
  </nav>
  
  <!-- Dropdown de notificaciones -->
  <div class="notifications-dropdown" *ngIf="showNotificaciones">
    <div class="notifications-header">
      <h3>Notificaciones</h3>
      <button class="btn-close-notifications" (click)="cerrarNotificaciones()">
        <i class="ri-close-line"></i>
      </button>
    </div>
    
    <div class="notifications-body">
      <div *ngIf="notificaciones.length === 0" class="no-notifications">
        <p>No tienes notificaciones nuevas</p>
      </div>
      
      <div *ngFor="let notif of notificaciones" 
           class="notification-item" 
           [class.unread]="!notif.leida"
           (click)="marcarComoLeida(notif)">
        <div class="notification-icon">
          <i class="ri-notification-3-fill" *ngIf="notif.tipoNotificacion === 'EVENTO_CREADO'"></i>
          <i class="ri-checkbox-circle-fill" *ngIf="notif.tipoNotificacion === 'EVENTO_APROBADO'"></i>
          <i class="ri-close-circle-fill" *ngIf="notif.tipoNotificacion === 'EVENTO_RECHAZADO'"></i>
        </div>
        <div class="notification-content">
          <p class="notification-message">{{ notif.mensaje }}</p>
          <span class="notification-time">{{ notif.fechaEnvio | date:'short' }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="events-section">
  <div class="events-header">
    <h1 class="events-title">
      <i class="ri-calendar-event-fill"></i>
      Eventos Universitarios UAO
    </h1>
    <p class="events-subtitle">Descubre todos los eventos universitarios disponibles</p>
  </div>

  <div *ngIf="events.length === 0" class="no-events">
    <i class="ri-calendar-close-line"></i>
    <p>No hay eventos aprobados en este momento</p>
  </div>

  <div class="events-grid">
    <div *ngFor="let event of events" class="event-card">
      <!-- Header de la tarjeta -->
      <div class="event-card-header">
        <h3 class="event-title">{{ event.titulo }}</h3>
        <span class="event-capacity">
          <i class="ri-group-line"></i>
          {{ event.capacidad }} personas
        </span>
      </div>

      <!-- Información principal -->
      <div class="event-info">
        <div class="info-row">
          <i class="ri-calendar-line"></i>
          <span class="info-label">Fecha:</span>
          <span class="info-value">{{ event.fecha | date:'EEEE, d \'de\' MMMM \'de\' y' }}</span>
        </div>

        <div class="info-row">
          <i class="ri-time-line"></i>
          <span class="info-label">Horarios:</span>
          <div class="time-slots">
            <div *ngFor="let instalacion of event.instalaciones; let i = index" class="time-slot">
              <span class="slot-number">{{ i + 1 }}.</span>
              <span class="slot-time">{{ instalacion.horaInicio }} - {{ instalacion.horaFin }}</span>
              <span class="slot-location">{{ instalacion.nombreInstalacion }}</span>
            </div>
          </div>
        </div>

        <div class="info-row" *ngIf="event.instalaciones && event.instalaciones.length > 0">
          <i class="ri-map-pin-line"></i>
          <span class="info-label">Instalaciones:</span>
          <div class="installations-list">
            <span *ngFor="let inst of event.instalaciones" class="installation-badge">
              {{ inst.nombreInstalacion }} ({{ inst.tipoInstalacion }})
            </span>
          </div>
        </div>

        <div class="info-row">
          <i class="ri-book-open-line"></i>
          <span class="info-label">Tipo:</span>
          <span class="info-value event-type">{{ event.tipoEvento }}</span>
        </div>

        <div class="info-row" *ngIf="event.organizadores && event.organizadores.length > 0 && getUsuarioPrograma(event.organizadores[0].idUsuario)">
          <i class="ri-graduation-cap-line"></i>
          <span class="info-label">Programa:</span>
          <span class="info-value">{{ getUsuarioPrograma(event.organizadores[0].idUsuario) }}</span>
        </div>

        <div class="info-row" *ngIf="event.organizadores && event.organizadores.length > 0 && getUsuarioUnidadAcademica(event.organizadores[0].idUsuario)">
          <i class="ri-building-line"></i>
          <span class="info-label">Unidad Académica:</span>
          <span class="info-value">{{ getUsuarioUnidadAcademica(event.organizadores[0].idUsuario) }}</span>
        </div>
      </div>

      <!-- Organizadores -->
      <div class="event-organizers" *ngIf="event.organizadores && event.organizadores.length > 0">
        <div class="organizers-header">
          <i class="ri-team-line"></i>
          <span>Organizadores</span>
        </div>
        <div class="organizers-list">
          <div *ngFor="let org of event.organizadores" class="organizer-item">
            <i class="ri-user-line"></i>
            <span class="organizer-name">{{ getUsuarioNombre(org.idUsuario) }}</span>
            <span class="organizer-email">{{ getUsuarioCorreo(org.idUsuario) }}</span>
          </div>
        </div>
      </div>

      <!-- Organizaciones Externas -->
      <div class="event-external-orgs" *ngIf="event.participacionesOrganizaciones && event.participacionesOrganizaciones.length > 0">
        <div class="external-orgs-header">
          <i class="ri-building-2-line"></i>
          <span>Organizaciones Externas</span>
        </div>
        <div class="external-orgs-list">
          <div *ngFor="let participacion of event.participacionesOrganizaciones" class="external-org-item">
            <div class="org-name">
              <i class="ri-briefcase-line"></i>
              <span>{{ participacion.nombreOrganizacion || getOrganizacionNombre(participacion.idOrganizacion) }}</span>
            </div>
            <div class="org-details">
              <span class="org-nit">NIT: {{ getOrganizacionNit(participacion.idOrganizacion) }}</span>
              <span class="org-representative">
                Representante: {{ participacion.representanteDiferente ? participacion.nombreRepresentanteDiferente : getOrganizacionRepresentante(participacion.idOrganizacion) }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer con fecha de aprobación -->
      <div class="event-card-footer">
        <span class="approval-badge">
          <i class="ri-checkbox-circle-fill"></i>
          Evento Aprobado
        </span>
      </div>
    </div>
  </div>
</div>
